<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="Open Access Button">{% if  title %}
    <title>Open Access Button - {{title|escape}}</title>{% else %}
    <title>Open Access Button</title>{% endif %}
    <link rel="shortcut icon" type="image/x-icon" href="/static/img/favicon.ico">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet/less" type="text/css" media="all" href="/static/less/styles.less">
    <script src="/static/js/lib/less-1.4.2.min.js"></script><!--[if lt IE 9]>
    <script src="/static/js/lib/html5shiv.js"></script>
    <script src="/static/js/lib/respond.min.js"></script><![endif]-->
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css"><!--[if lte IE 8]>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css"><![endif]-->
  </head>
  <body data-spy="scroll" data-target=".navbar">{% block body %}{% endblock %}
  </body>
  <!-- JQuery and plugins-->
  <script src="/static/js/lib/jquery.min.js"></script>
  <script src="http://codeorigin.jquery.com/color/jquery.color-2.1.2.min.js"></script>
  <script src="/static/js/lib/jquery.form.js"></script>
  <!-- Bootstrap and plugins-->
  <script src="/static/js/lib/bootstrap.js"></script>
  <script src="/static/js/lib/bootstrap-dialog.js"></script>
  <!-- Leaflet-->
  <script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
  <script src="/static/js/lib/leaflet.markercluster.js"></script>
  <!-- Server vars-->
  <script>var events = {{ events|safe }};

</script>
  <!-- Application scripts-->
  <script src="/static/js/map.js"></script>
<script>

    // Highlight some node. This ought to be moved to some common JS
    $.fn.animateHighlight = function(highlightColor, duration) {
        var highlightBg = highlightColor || "#FFFF9C";
        var animateMs = duration || 1500;
        var originalBg = this.css("backgroundColor");
        this.stop().css("background-color",
        highlightBg).animate({backgroundColor:
            originalBg}, animateMs);
    };


    // wait for the DOM to be loaded 
    $(document).ready(function() { 
        // first hide the bookmarklet
        $('#bookmarklet').hide();

        // bind 'myForm' and provide a simple callback function 
        var options = { 
            target:     '#divToUpdate',
            dataType:   'json',
            url:        '/api/signin/',
            error:      function(ctx) {
                var errors = JSON.parse(ctx.responseText).errors;

                if ('email' in errors) {
                    $('#id_email').animateHighlight("#dd0000", 1000);
                }

                if ('name' in errors) {
                    $('#id_name').animateHighlight("#dd0000", 1000);
                }

                if ('confirm_public' in errors) {
                    $('label.confirm-label').animateHighlight("#dd0000", 1000);
                }
            },
            success:    function(responseJSON, statusText, xhr, formElem) { 
                $('#bookmarklet-js').attr('href',
                "javascript:document.getElementsByTagName('body')[0].appendChild(document.createElement('script')).setAttribute('src','"+responseJSON['url']+"');");

                // Show the new bookmarklet
                $('#bookmarklet').show();

                var dialog = new BootstrapDialog({
                    title : $('<h2>Drag this to your bookmark bar</h2>'),
                    content: $("<a href=\"javascript:document.getElementsByTagName('body')[0].appendChild(document.createElement('script')).setAttribute('src','"+responseJSON['url']+"');\" class=\"btn btn-large\"><i class=\"icon-bookmark\"></i> Open Access Button </a>"),
                    buttons :   [{
                        label : 'OK',
                        onclick :
                        function(dialog){
                            dialog.close();
                        }
                    }]
                });
                dialog.open();

            } 
        }; 
        $('#form-bookmarklet').ajaxForm(options);
    }); 
</script>
</html>
